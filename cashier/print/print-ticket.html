<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>Квиток</title>

<style>
  /* ====== PAGE ====== */
  @page {
    size: 80mm auto;
    margin: 0;
  }

  body {
    margin: 0;
    padding: 0;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    color: #000;
  }

  .ticket {
    width: 80mm;
    padding: 6mm 5mm 4mm 5mm;
    box-sizing: border-box;
  }

  /* ====== TEXT BLOCK ====== */
  .title {
    font-size: 14px;
    font-weight: 800;
    text-align: center;
    margin-bottom: 4mm;
  }

  .line {
    font-size: 12px;
    margin-bottom: 2mm;
  }

  .line b {
    font-weight: 700;
  }

  .divider {
    border-top: 1px dashed #000;
    margin: 4mm 0;
  }

  /* ====== QR BLOCK ====== */
  .qr-wrap {
    display: flex;
    justify-content: center;
    margin-top: 4mm;
  }

  #qrcode {
    width: 32mm;
    height: 32mm;
  }

  .qr-caption {
    font-size: 9px;
    text-align: center;
    margin-top: 2mm;
  }

  /* ====== HIDE UI ON PRINT ====== */
  @media print {
    body { margin: 0; }
  }
</style>
</head>

<body>

<div class="ticket">
  <div class="title" id="t_title">Назва події</div>

  <div class="line"><b>Дата:</b> <span id="t_date">—</span></div>
  <div class="line"><b>Час:</b> <span id="t_time">—</span></div>
  <div class="line"><b>Місце:</b> <span id="t_seat">—</span></div>
  <div class="line"><b>Ціна:</b> <span id="t_price">—</span></div>

  <div class="divider"></div>

  <div class="qr-wrap">
    <div id="qrcode"></div>
  </div>

  <div class="qr-caption">
    Предʼявіть QR контролеру
  </div>
</div>

<!-- QR LIB -->
<script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>

<script>
/* ==========================
   DATA SOURCE
========================== */

/*
  Ожидаемый формат (строка):
  SEANCE_ID|SEAT|ORDER_ID|TIMESTAMP
*/

let ticket = {
  title: "Подія",
  date: "2026-02-10",
  time: "19:00",
  seat: "P3-M12",
  price: "200 грн",
  qr: ""
};

/* === 1. из query (?data=...) === */
const qs = new URLSearchParams(location.search);
if (qs.get("data")) {
  try {
    const d = JSON.parse(decodeURIComponent(qs.get("data")));
    Object.assign(ticket, d);
  } catch {}
}

/* === 2. из postMessage (предпочтительно) === */
window.addEventListener("message", e => {
  if (!e.data || !e.data.qr) return;
  Object.assign(ticket, e.data);
  render();
});

/* ==========================
   RENDER
========================== */
function render(){
  t_title.textContent = ticket.title;
  t_date.textContent  = ticket.date;
  t_time.textContent  = ticket.time;
  t_seat.textContent  = ticket.seat;
  t_price.textContent = ticket.price;

  document.getElementById("qrcode").innerHTML = "";

  new QRCode(document.getElementById("qrcode"), {
    text: ticket.qr,
    width: 240,
    height: 240,
    correctLevel: QRCode.CorrectLevel.M
  });

  setTimeout(()=>window.print(), 200);
}

/* ==========================
   INIT (demo fallback)
========================== */
if (!ticket.qr) {
  ticket.qr = "koncert-2026-02-10-19-00|P3-M12|ORD-000154|2026-02-10T18:42";
}
render();
</script>

</body>
</html>
