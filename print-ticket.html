<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>Квиток (каса)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  font-family:system-ui,-apple-system,"Segoe UI",sans-serif;
  background:#f3f4f6;
  display:flex;
  justify-content:center;
  padding:20px;
}
.ticket{
  width:260px;
  background:#fff;
  border-radius:14px;
  box-shadow:0 10px 25px rgba(0,0,0,.12);
  padding:16px;
}
h1{font-size:16px;margin:0 0 8px}
.row{font-size:13px;margin:4px 0}
.qr-wrap{
  margin:14px auto;
  width:120px;
  height:120px;
  border:1px solid #ddd;
  border-radius:10px;
  display:flex;
  align-items:center;
  justify-content:center;
}
.footer{
  font-size:11px;
  color:#555;
  text-align:center;
  margin-top:10px;
}
</style>

<!-- ЛОКАЛЬНАЯ библиотека, без CDN -->
<script src="./vendor/qrcode.min.js"></script>
</head>

<body>
<div class="ticket">
  <h1>Квиток</h1>
  <div class="row"><b>Канал:</b> Каса</div>
  <div class="row" id="rowSeat"></div>
  <div class="row" id="rowPrice"></div>

  <div class="qr-wrap" id="qr"></div>

  <div class="footer">
    Покажіть цей квиток контролеру
  </div>
</div>

<script>
(function(){
  const p = new URLSearchParams(location.search);

  const seat  = p.get("seat")  || "";
  const price = p.get("price") || "";

  // ⚠️ КРИТИЧНО: формат для scanner.js
  // scanner принимает офлайн ТОЛЬКО если начинается с order:CASH-
  const qrPayload =
    "order:CASH-" +
    Date.now().toString(36) + "-" +
    Math.random().toString(36).slice(2,8);

  if(seat)  document.getElementById("rowSeat").textContent  = "Місце: " + seat;
  if(price) document.getElementById("rowPrice").textContent = "Ціна: " + price + " грн";

  const box = document.getElementById("qr");
  box.innerHTML = "";

  new QRCode(box,{
    text: qrPayload,
    width:110,
    height:110,
    correctLevel: QRCode.CorrectLevel.M
  });

})();
</script>
</body>
</html>
