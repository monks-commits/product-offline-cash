<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>–ü–æ–¥—ñ—ó ‚Äî —Ä–æ–±–æ—á—ñ —Å–µ–∞–Ω—Å–∏</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="../styles.css">

<style>
.page-wrap{
  padding:20px;
  max-width:1200px;
  margin:auto;
}

h1{margin-bottom:16px}

.list{
  display:grid;
  gap:12px;
}

.card{
  background:#fff;
  border-radius:14px;
  padding:16px;
  box-shadow:0 4px 14px rgba(0,0,0,.06);
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
}

.meta{
  display:flex;
  flex-direction:column;
  gap:4px;
}

.meta strong{font-size:16px}
.meta span{font-size:13px;color:#6b7280}

.badge{
  padding:4px 10px;
  border-radius:999px;
  font-size:12px;
  background:#e5e7eb;
}

.badge.ready{background:#bbf7d0}

.actions{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}

.btn{
  padding:10px 14px;
  border-radius:12px;
  border:none;
  font-weight:800;
  cursor:pointer;
}

.btn-primary{background:#111827;color:#fff}
.btn-ghost{background:#f3f4f6}
</style>
</head>

<body>

<div id="admin-header"></div>

<main class="page-wrap">
  <h1>üé≠ –ü–æ–¥—ñ—ó (—Ä–æ–±–æ—á—ñ —Å–µ–∞–Ω—Å–∏)</h1>

  <div id="list" class="list">
    <div class="card">
      <span>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è‚Ä¶</span>
    </div>
  </div>
</main>

<script>
/* =========================
   LOAD SEANCES (OFFLINE)
========================= */
async function loadSeances(){
  const container = document.getElementById("list");
  container.innerHTML = "";

  try {
    const res = await fetch("../../data/seances/");
    const text = await res.text();

    // GitHub Pages directory listing hack
    const matches = [...text.matchAll(/href="([^"]+\.json)"/g)];
    const files = matches.map(m=>m[1]);

    if (!files.length){
      container.innerHTML = "<div class='card'>–ù–µ–º–∞—î –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö —Å–µ–∞–Ω—Å—ñ–≤</div>";
      return;
    }

    for (const file of files){
      const data = await fetch(`../../data/seances/${file}`).then(r=>r.json());

      const card = document.createElement("div");
      card.className = "card";

      const meta = document.createElement("div");
      meta.className = "meta";
      meta.innerHTML = `
        <strong>${data.seance_id}</strong>
        <span>–°—Ç–∞—Ç—É—Å: ${data.status}</span>
      `;

      const badge = document.createElement("span");
      badge.className = "badge " + (data.status==="ready"?"ready":"");
      badge.textContent = data.status==="ready" ? "–≥–æ—Ç–æ–≤–∏–π" : "—á–µ—Ä–Ω–µ—Ç–∫–∞";

      const actions = document.createElement("div");
      actions.className = "actions";

      const sellBtn = document.createElement("button");
      sellBtn.className = "btn btn-primary";
      sellBtn.textContent = "–ü—Ä–æ–¥–∞–∂";
      sellBtn.onclick = ()=>{
        window.location.href = `../../cashier/sales/index.html?seance=${data.seance_id}`;
      };

      const editBtn = document.createElement("button");
      editBtn.className = "btn btn-ghost";
      editBtn.textContent = "–†–µ–¥–∞–≥—É–≤–∞—Ç–∏";
      editBtn.onclick = ()=>{
        window.location.href = `../create/index.html?seance=${data.seance_id}`;
      };

      actions.appendChild(sellBtn);
      actions.appendChild(editBtn);

      card.appendChild(meta);
      card.appendChild(badge);
      card.appendChild(actions);

      container.appendChild(card);
    }

  } catch(e){
    container.innerHTML = "<div class='card'>–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å–µ–∞–Ω—Å—ñ–≤</div>";
    console.error(e);
  }
}

/* =========================
   HEADER
========================= */
fetch("../index.html")
  .then(r=>r.text())
  .then(html=>{
    document.getElementById("admin-header").innerHTML = html;
  });

loadSeances();
</script>

</body>
</html>
