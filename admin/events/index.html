<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>–ü–æ–¥—ñ—ó ‚Äî –∞–∫—Ç–∏–≤–Ω—ñ —Å–µ–∞–Ω—Å–∏</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="../styles.css">

<style>
.page-wrap{padding:20px;max-width:1200px;margin:auto}
.card{
  background:#fff;border-radius:14px;padding:16px;margin-bottom:16px;
  box-shadow:0 4px 14px rgba(0,0,0,.06);
}
h1{margin-bottom:12px}
.list{display:flex;flex-direction:column;gap:10px}
.item{
  display:grid;
  grid-template-columns:1fr auto auto;
  gap:12px;
  align-items:center;
  padding:12px;
  border-radius:12px;
  border:1px solid #e5e7eb;
}
.meta{
  font-size:14px;
}
.meta b{font-size:15px}
.badge{
  padding:4px 10px;border-radius:999px;
  font-size:12px;background:#bbf7d0;
}
.actions{display:flex;gap:8px}
.btn{
  padding:8px 14px;border-radius:10px;
  border:none;font-weight:800;cursor:pointer;
}
.btn-sell{background:#111827;color:#fff}
.btn-edit{background:#f3f4f6}
.empty{
  opacity:.6;font-size:14px;padding:20px;
}
</style>
</head>

<body>

<div id="admin-header"></div>

<main class="page-wrap">
  <h1>üé≠ –ü–æ–¥—ñ—ó (–≥–æ—Ç–æ–≤—ñ –¥–æ –ø—Ä–æ–¥–∞–∂—É)</h1>

  <div id="list" class="list"></div>
</main>

<script>
/* =====================
   LOAD SEANCES
===================== */
async function loadSeances(){
  const res = await fetch("../../data/seances/index.json").catch(()=>null);

  if(!res){
    list.innerHTML = "<div class='empty'>–ù–µ–º–∞—î —ñ–Ω–¥–µ–∫—Å—É seances</div>";
    return;
  }

  const files = await res.json(); // ["id.json", ...]
  const seances = [];

  for(const file of files){
    try{
      const data = await fetch(`../../data/seances/${file}`).then(r=>r.json());
      if(data.status==="ready"){
        seances.push(data);
      }
    }catch{}
  }

  render(seances);
}

/* =====================
   RENDER
===================== */
function render(seances){
  if(!seances.length){
    list.innerHTML = "<div class='empty'>–ù–µ–º–∞—î –≥–æ—Ç–æ–≤–∏—Ö —Å–µ–∞–Ω—Å—ñ–≤</div>";
    return;
  }

  seances.sort((a,b)=>{
    const da = `${a.date} ${a.time}`;
    const db = `${b.date} ${b.time}`;
    return da.localeCompare(db);
  });

  list.innerHTML = "";

  seances.forEach(s=>{
    const div = document.createElement("div");
    div.className = "item";

    div.innerHTML = `
      <div class="meta">
        <b>${s.event || s.seance_id}</b><br>
        ${s.date} ${s.time}
      </div>

      <span class="badge">–≥–æ—Ç–æ–≤–∏–π</span>

      <div class="actions">
        <button class="btn btn-sell" onclick="goSell('${s.seance_id}')">–ü—Ä–æ–¥–∞–∂—ñ</button>
        <button class="btn btn-edit" onclick="goEdit('${s.seance_id}')">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</button>
      </div>
    `;

    list.appendChild(div);
  });
}

/* =====================
   NAV
===================== */
function goSell(id){
  location.href = `../sales/index.html?seance=${id}`;
}
function goEdit(id){
  location.href = `../create/index.html?seance=${id}`;
}

/* =====================
   HEADER
===================== */
fetch("../index.html")
  .then(r=>r.text())
  .then(html=>admin-header.innerHTML=html);

loadSeances();
</script>

</body>
</html>
