<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>–°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å–µ–∞–Ω—Å—É</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" href="../../styles.css">

  <style>
    body{
      margin:0;
      background:#f1f5f9;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
      color:#0f172a;
    }

    .page{
      max-width:1200px;
      margin:auto;
      padding:24px;
    }

    h1{margin:0 0 16px}

    .card{
      background:#fff;
      border-radius:14px;
      padding:16px;
      margin-bottom:16px;
      box-shadow:0 4px 14px rgba(0,0,0,.06);
    }

    .row{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      align-items:end;
    }

    label{
      font-size:13px;
      color:#475569;
      display:flex;
      flex-direction:column;
      gap:4px;
    }

    input,select{
      padding:8px 10px;
      border-radius:8px;
      border:1px solid #cbd5f5;
      font-size:14px;
    }

    .actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }

    .btn{
      padding:10px 16px;
      border-radius:12px;
      border:none;
      font-weight:800;
      cursor:pointer;
    }

    .btn-primary{background:#111827;color:#fff}
    .btn-ghost{background:#e2e8f0}

    iframe{
      width:100%;
      height:520px;
      border:1px solid #e5e7eb;
      border-radius:12px;
      background:#f8fafc;
    }

    .badge{
      padding:4px 10px;
      border-radius:999px;
      font-size:12px;
      background:#e5e7eb;
    }
  </style>
</head>

<body>

<!-- —à–∞–ø–∫–∞ –∞–¥–º–∏–Ω–∞ -->
<div id="admin-header"></div>

<div class="page">
  <h1>üõ† –°—Ç–≤–æ—Ä–µ–Ω–Ω—è / —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —Å–µ–∞–Ω—Å—É</h1>

  <!-- 1. –î–∞–Ω–Ω—ã–µ —Å–µ–∞–Ω—Å–∞ -->
  <div class="card">
    <h3>1Ô∏è‚É£ –î–∞–Ω—ñ —Å–µ–∞–Ω—Å—É</h3>

    <div class="row">
      <label>
        –ù–∞–∑–≤–∞ –ø–æ–¥—ñ—ó
        <input id="title" placeholder="–ö–æ–Ω—Ü–µ—Ä—Ç / –í–∏—Å—Ç–∞–≤–∞">
      </label>

      <label>
        –î–∞—Ç–∞
        <input id="date" type="date">
      </label>

      <label>
        –ß–∞—Å
        <input id="time" type="time">
      </label>

      <label>
        Seance ID
        <input id="seanceId" disabled>
      </label>

      <span class="badge" id="status">—á–µ—Ä–Ω–µ—Ç–∫–∞</span>
    </div>
  </div>

  <!-- 2. –¶–µ–Ω—ã –∏ –ø—Ä–∞–≤–∏–ª–∞ -->
  <div class="card">
    <h3>2Ô∏è‚É£ –¶—ñ–Ω–∏, –∫–æ–ª—å–æ—Ä–∏, –ø—Ä–∞–≤–∏–ª–∞</h3>

    <!-- –≤—Å—Ç—Ä–∞–∏–≤–∞–µ–º –≠–¢–ê–õ–û–ù–ù–´–ô —Ä–µ–¥–∞–∫—Ç–æ—Ä -->
    <iframe src="../../seance-editor.html?embed=1"></iframe>
  </div>

  <!-- 3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ -->
  <div class="card">
    <h3>3Ô∏è‚É£ –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è</h3>

    <div class="actions">
      <button class="btn btn-primary" onclick="save()">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏</button>
      <button class="btn btn-ghost" onclick="cancel()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
    </div>
  </div>
</div>

<script>
/* –ø–æ–¥–∫–ª—é—á–∞–µ–º —à–∞–ø–∫—É */
fetch("../index.html")
  .then(r=>r.text())
  .then(html=>{
    document.getElementById("admin-header").innerHTML = html;
  });

/* –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */
const params = new URLSearchParams(location.search);
const existingId = params.get("seance");

/* –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è id */
function buildId(){
  const d = date.value;
  const t = time.value;
  if(!d || !t) return "";

  const hhmm = t.replace(":","-");
  return `${title.value || "event"}-${d}-${hhmm}`;
}

date.onchange = time.onchange = title.oninput = () => {
  seanceId.value = buildId();
};

/* –∑–∞–≥—Ä—É–∑–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ */
if(existingId){
  fetch(`../../data/seances/${existingId}.json`)
    .then(r=>r.json())
    .then(data=>{
      title.value = data.title || "";
      status.textContent = "—Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è";
      seanceId.value = existingId;
    });
}

/* —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ */
function save(){
  const id = seanceId.value;
  if(!id){
    alert("–ù–µ–≤—ñ—Ä–Ω—ñ –¥–∞–Ω—ñ —Å–µ–∞–Ω—Å—É");
    return;
  }

  const data = {
    title: title.value,
    datetime: `${date.value} ${time.value}`,
    pricing: {} // —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ iframe
  };

  console.log("SAVE seance:", id, data);
  alert("JSON —Å—Ñ–æ—Ä–º–æ–≤–∞–Ω–æ. –î–∞–ª—ñ ‚Äî commit –∞–±–æ sync (–ø—ñ–∑–Ω—ñ—à–µ).");
}

function cancel(){
  history.back();
}
</script>

</body>
</html>
