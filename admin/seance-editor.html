<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>–†–µ–¥–∞–∫—Ç–æ—Ä —Å–µ–∞–Ω—Å—É ‚Äî —Ü—ñ–Ω–∏ —Ç–∞ –∑–æ–Ω–∏</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family: system-ui, -apple-system, Segoe UI, sans-serif;
  background:#f3f4f6;
  margin:0;
  padding:20px;
}
.wrap{max-width:900px;margin:auto;}
h1{margin-bottom:10px}
.card{
  background:#fff;
  border-radius:12px;
  padding:16px;
  margin-bottom:16px;
  box-shadow:0 4px 14px rgba(0,0,0,.08);
}
.row{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:10px}
label{font-size:14px}
input,select,button,textarea{
  padding:8px 10px;
  font-size:14px;
}
button{cursor:pointer}
textarea{
  width:100%;
  height:260px;
  font-family:monospace;
}
.badge{
  font-size:12px;
  padding:2px 6px;
  border-radius:6px;
  background:#e5e7eb;
}
</style>
</head>

<body>
<div class="wrap">

<h1>üéõÔ∏è –†–µ–¥–∞–∫—Ç–æ—Ä seance.json</h1>
<p class="badge">–ì–µ–Ω–µ—Ä—É—î —Ü—ñ–Ω–∏ + CSS-–∫–ª–∞—Å–∏ –¥–ª—è hall.html</p>

<div class="card">
  <div class="row">
    <label>Seance ID</label>
    <input id="seanceId" placeholder="koncert-2026-02-10-19-00" style="flex:1">
  </div>
</div>

<div class="card">
  <h3>‚ûï –ü—Ä–∞–≤–∏–ª–æ –ø–æ —Ä—è–¥–∞—Ö</h3>

  <div class="row">
    <label>–ó–æ–Ω–∞</label>
    <select id="zone">
      <option value="P">–ü–∞—Ä—Ç–µ—Ä</option>
      <option value="A">–ê–º—Ñ—ñ—Ç–µ–∞—Ç—Ä</option>
      <option value="B">–ë–∞–ª–∫–æ–Ω</option>
    </select>

    <label>–†—è–¥–∏</label>
    <input id="fromRow" type="number" placeholder="–≤—ñ–¥">
    <input id="toRow" type="number" placeholder="–¥–æ">

    <label>–¶—ñ–Ω–∞</label>
    <input id="price" type="number" placeholder="200">

    <label>
      <input type="checkbox" id="sale" checked>
      –ü—Ä–æ–¥–∞—î—Ç—å—Å—è
    </label>

    <button onclick="addRule()">–î–æ–¥–∞—Ç–∏</button>
  </div>
</div>

<div class="card">
  <h3>üéØ –û–∫—Ä–µ–º–µ –º—ñ—Å—Ü–µ</h3>
  <div class="row">
    <input id="seatKey" placeholder="P3-M5">
    <input id="seatPrice" type="number" placeholder="—Ü—ñ–Ω–∞">
    <label>
      <input type="checkbox" id="seatSale">
      –ó–∞–±–æ—Ä–æ–Ω–∏—Ç–∏ –ø—Ä–æ–¥–∞–∂
    </label>
    <button onclick="addSeatOverride()">–î–æ–¥–∞—Ç–∏</button>
  </div>
</div>

<div class="card">
  <h3>üìÑ seance.json</h3>
  <textarea id="output"></textarea>
  <button onclick="copy()">üìã –°–∫–æ–ø—ñ—é–≤–∞—Ç–∏</button>
</div>

<button id="publish">üöÄ –û–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏</button>

</div>

<script>
const SUPABASE_FUNCTION_URL =
  "https://fhusjlkneckbvnrdhbil.supabase.co/functions/v1/save-seance";

const data = {
  pricing: {},
  seat_overrides: {}
};

function seatClass(price){
  return `seat--${price}`;
}

function addRule(){
  const z = zone.value;
  const from = fromRow.value;
  const to = toRow.value;
  const p = price.value;
  const saleAllowed = sale.checked;

  if(!from || !to || !p){
    alert("–ó–∞–ø–æ–≤–Ω–∏ —Ä—è–¥–∏ —ñ —Ü—ñ–Ω—É");
    return;
  }

  const key = `${z}${from}-${to}`;
  data.pricing[key] = {
    price: Number(p),
    class: seatClass(p),
    sale: saleAllowed
  };
  render();
}

function addSeatOverride(){
  const key = seatKey.value.trim();
  if(!key) return;

  const obj = {};
  if(seatPrice.value){
    obj.price = Number(seatPrice.value);
    obj.class = seatClass(seatPrice.value);
  }
  if(seatSale.checked){
    obj.sale = false;
  }

  data.seat_overrides[key] = obj;
  render();
}

function render(){
  const out = {
    seance_id: seanceId.value.trim(),
    pricing: data.pricing,
    seat_overrides: data.seat_overrides
  };
  output.value = JSON.stringify(out, null, 2);
}

function copy(){
  output.select();
  document.execCommand("copy");
  alert("–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ");
}

document.getElementById("publish").onclick = async () => {
  const seance = seanceId.value.trim();
  if(!seance){
    alert("–í–∫–∞–∂–∏ Seance ID");
    return;
  }

  const payload = {
    seance_id: seance,
    pricing: data.pricing,
    seat_overrides: data.seat_overrides
  };

  const res = await fetch(SUPABASE_FUNCTION_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  });

  if(res.ok){
    alert("‚úÖ –û–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω–æ");
  } else {
    alert("‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—É–±–ª—ñ–∫–∞—Ü—ñ—ó");
  }
};
</script>

</body>
</html>
